@page "/extramaterial-admin"
@using shared.Equipment

<PageTitle>Aanpassen extra's'</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large">
    <MudGrid Justify="Justify.SpaceEvenly">
        <MudItem lg="1" md="1" sm="12" xs="12">

        </MudItem>
        <MudItem lg="4" md="5" sm="12" xs="12">
            <MudText Class="mt-6" Typo="Typo.h4">Overzicht extra materiaal</MudText>
        </MudItem>
        <MudItem lg="7" md="6" sm="12" xs="12">

        </MudItem>
        <MudItem lg="1" md="12" sm="12" xs="12">

        </MudItem>
        <MudItem lg="10" md="12" sm="12" xs="12">
            <MudTable Items="@Extras" Hover="true" Breakpoint="Breakpoint.Xs" Loading="@Loading" LoadingProgressColor="Color.Info">
                <HeaderContent>
                    <MudTh>Titel</MudTh>
                    <MudTh>Prijs</MudTh>
                    <MudTh>Stock</MudTh>
                    <MudTh>Aanpassen</MudTh>
                    <MudTh>Verwijderen</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Titel">@context.Title</MudTd>
                    <MudTd DataLabel="Prijs">@(Decimal.Round(@context.Price,2))</MudTd>
                    <MudTd DataLabel="Stock">@context.Stock</MudTd>
                        <MudTd DataLabel="Aanpassen"><MudButton Variant="Variant.Filled" Color="Color.Primary">Aanpassen</MudButton></MudTd>
                        <MudTd DataLabel="Verwijderen"><MudButton Variant="Variant.Filled" Color="Color.Primary">Verwijderen</MudButton></MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager />
                </PagerContent>
            </MudTable>
        </MudItem>
        <MudItem lg="1" md="12" sm="12" xs="12">

        </MudItem>
        <MudItem lg="8" md="8" sm="5" xs="5">

        </MudItem>
            <MudItem lg="3" md="3" sm="7" xs="7">
                <MudButton OnClick="AddItem" Class="mb-6" Variant="Variant.Filled" Color="Color.Primary">Extra item toevoegen</MudButton>
            </MudItem>
            <MudItem lg="1" md="1" sm="12" xs="12">

            </MudItem>
    </MudGrid>
</MudContainer>

    @code {
    [Inject]
    public IEquipmentService EquipmentService { get; set; } = default!;

    private IEnumerable<EquipmentDto.Index>? Extras = default!;

    private bool Loading { get; set; } = true;

    [Inject] ISidepanelService Sidepanel { get; set; } = default!;

    protected override async Task OnInitializedAsync()
    {
        EquipmentResult.Index response = await EquipmentService.GetIndexAsync();

        Extras = response.Equipment;

        Loading = false;

    }

    private void AddItem()
    {
        var callback1 = EventCallback.Factory.Create(this, Close);
        var callback2 = EventCallback.Factory.Create(this, Refresh);

        var parameters = new Dictionary<string,object>
        {
            {nameof(CreateExtra.Close),callback1 },
            {nameof(CreateExtra.Refresh),callback2 },
        };

        Sidepanel.Open<CreateExtra>("Extra item","toevoegen",parameters);
    }
    private void Close()
    {
        Sidepanel.Close();    
    }
    private void Refresh()
    {
        StateHasChanged();    
    }
}
